- name: Set /etc/hosts
  lineinfile: dest=/etc/hosts line="{{  ops_ip }} ops1.{{ zone }}.{{ domain }} ops1"

- name: Copy puppet master service description
  copy: src=puppetmaster.xml 
        dest=/etc/firewalld/services/puppetmaster.xml
        mode=0644
        owner=root
        group=root
  notify:
    - restart firewalld
- meta: flush_handlers

- name: Remove Management Interface from Public Zone
  command: /bin/firewall-cmd --zone=public --remove-interface={{ ops_mgmt_interface }} --permanent
  notify:
    - restart firewalld

- name: Add Management Interface to Internal Zone
  command: /bin/firewall-cmd --zone=internal --add-interface={{ ops_mgmt_interface }} --permanent
  notify:
    - restart firewalld

- name: Configure Internal Firewalld
  firewalld: service={{ item }} zone=internal permanent=true state=enabled
  with_items:
    - https
    - tftp
    - dns
    - http
    - puppetmaster

  notify:
    - restart firewalld

- meta: flush_handlers

- name: Wait for networking...
  command: /bin/sleep 10
  async: 45
